<!DOCTYPE html>
<html>
<head>
  <title>Ultra Pure White Semi-Gloss Paint – 50 Stores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <style>
    body{margin:0;padding:0;font-family:Arial,sans-serif}
    #map{width:100%;height:100vh}
    h3{font-size:1.5em;padding:10px;text-align:center;margin:0;background:#1a73e8;color:white}
    #location-button{
      position:absolute;top:60px;left:10px;z-index:1000;
      padding:10px;background:#fff;border:2px solid #ccc;border-radius:4px;
      cursor:pointer;font-size:1em;box-shadow:0 2px 6px rgba(0,0,0,.3)
    }
    #info-panel{
      position:absolute;top:110px;left:10px;z-index:1000;
      background:#fff;border:2px solid #ccc;border-radius:4px;
      padding:10px;max-height:200px;overflow-y:auto;display:none;width:260px;
      box-shadow:0 2px 6px rgba(0,0,0,.3);font-size:0.9em
    }
    #info-panel.show{display:block}
    a{color:#1a73e8;text-decoration:none;font-weight:bold}
    a:hover{text-decoration:underline}
    #allow-banner{
      position:fixed;bottom:0;left:0;right:0;
      background:#fffde7;padding:12px 16px;
      border-top:2px solid #ffc107;text-align:center;
      font-size:0.95em;z-index:2000;display:none;
      box-shadow:0 -2px 8px rgba(0,0,0,.1)
    }
    #allow-banner.show{display:block}
    #allow-btn{background:#1a73e8;color:#fff;padding:6px 14px;
      border:none;border-radius:4px;cursor:pointer;margin-left:8px}
    @media(max-width:768px){
      h3{font-size:1.2em}
      #location-button{top:55px;padding:8px;font-size:0.9em}
      #info-panel{top:100px;width:90%;left:5%;max-height:180px;font-size:0.85em}
      #allow-banner{font-size:0.9em;padding:10px}
    }
  </style>
</head>
<body>
  <h3>Ultra Pure White Semi-Gloss Paint – 50 Stores (Green: In Stock, Blue: Restock)</h3>
  <button id="location-button">Center on Current Location</button>
  <div id="info-panel"></div>
  <div id="allow-banner">
    <span>This site wants to open directions in your maps app.</span>
    <button id="allow-btn">Allow</button>
  </div>
  <div id="map"></div>

  <script>
    let map, userMarker, directionsAllowed = false;

    // ---------- POP-UP BLOCKER HANDLER ----------
    const banner = document.getElementById('allow-banner');
    const allowBtn = document.getElementById('allow-btn');

    function requestDirectionsPermission(address) {
      if (directionsAllowed) {
        launchDirections(address);
        return;
      }
      // Show banner the first time
      banner.classList.add('show');
      allowBtn.onclick = () => {
        directionsAllowed = true;
        banner.classList.remove('show');
        launchDirections(address);
      };
    }

    function launchDirections(address) {
      const clean = address.replace(/&/g, '%26').trim();
      const enc = encodeURIComponent(clean);
      const mobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      if (mobile) {
        window.location.href = `geo:0,0?q=${enc}`;
      } else {
        window.open(`https://www.google.com/maps/dir/?api=1&destination=${enc}`, '_blank');
      }
    }

    // ---------- MAP INITIALISATION ----------
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 7,
        center: { lat: 37.5407, lng: -77.4360 },
        gestureNeeded: 'greedy',
        mapTypeControl: false,
        streetViewControl: false
      });

      // One-time location centering
      document.getElementById("location-button").addEventListener("click", () => {
        if (!navigator.geolocation) { alert("Geolocation not supported."); return; }
        navigator.geolocation.getCurrentPosition(
          pos => {
            const loc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            map.panTo(loc); map.setZoom(12);
            if (userMarker) userMarker.setPosition(loc);
            else userMarker = new google.maps.Marker({
              position: loc, map: map,
              icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
              title: "You Are Here"
            });
          },
          err => alert("Location error: " + err.message),
          { enableHighAccuracy: true, timeout: 8000 }
        );
      });

      // ---------- STORE DATA ----------
      const stores = [
        {addr:"7251 Bell Creek Rd, Mechanicsville VA",title:"Store #4624",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:4,lat:37.6078,lng:-77.3747},
        {addr:"6501 W Broad St, Richmond VA",title:"Store #4632",price:"$144.00",stock:1,loc:"Aisle 6 - Bay 12",dist:5,lat:37.5985,lng:-77.5166},
        {addr:"10233 Lakeridge Parkway, Ashland VA",title:"Store #4653",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:8,lat:37.7089,lng:-77.4594},
        {addr:"1386 Car Mia Way, Richmond VA",title:"Store #4631",price:"$288.00",stock:3,loc:"Aisle 7 - Bay 11",dist:11,lat:37.5057,lng:-77.6087},
        {addr:"11260 W Broad St, Glen Allen VA",title:"Store #4611",price:"$288.00",stock:2,loc:"N/A",dist:11,lat:37.6521,lng:-77.5668},
        {addr:"12300 Chattanooga Plaza, Midlothian VA",title:"Store #4627",price:"$288.00",stock:3,loc:"Aisle 6 - Bay 13",dist:15,lat:37.4505,lng:-77.6488},
        {addr:"12300 Jefferson Davis Hwy, Chester VA",title:"Store #4616",price:"$288.00",stock:3,loc:"Aisle 7 - Bay 11",dist:15,lat:37.3628,lng:-77.4337},
        {addr:"2600 Conduit Rd, Colonial Heights VA",title:"Store #4633",price:"$288.00",stock:3,loc:"N/A",dist:22,lat:37.2694,lng:-77.4071},
        {addr:"6700 Mooretown Rd, Williamsburg VA",title:"Store #4635",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:41,lat:37.2911,lng:-76.7447},
        {addr:"1201 Gateway Blvd, Fredericksburg VA",title:"Store #4620",price:"$288.00",stock:3,loc:"Aisle 7 - Bay 12",dist:50,lat:38.3071,lng:-77.4932},
        {addr:"5771 Plank Road, Fredericksburg VA",title:"Store #4660",price:"$288.00",stock:4,loc:"Aisle 5 - Bay 12",dist:50,lat:38.2978,lng:-77.5301},
        {addr:"6921 Walton Lane, Gloucester VA",title:"Store #4650",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:51,lat:37.4067,lng:-76.5347},
        {addr:"325 Chatham Dr, Newport News VA",title:"Store #4613",price:"$262.00",stock:0,loc:"N/A",dist:59,lat:37.0911,lng:-76.4889},
        {addr:"305 Worth Avenue, Stafford VA",title:"Store #4637",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:62,lat:38.4578,lng:-77.4089},
        {addr:"1413 N Armistead Ave, Hampton VA",title:"Store #4612",price:"$288.00",stock:3,loc:"Aisle 8 - Bay 11",dist:69,lat:37.0497,lng:-76.3847},
        {addr:"250 Frank D Harris Dr, South Hill VA",title:"Store #4659",price:"$288.00",stock:3,loc:"Aisle 5 - Bay 11",dist:71,lat:36.7278,lng:-78.1422},
        {addr:"14025 Foulger Square, Woodbridge VA",title:"Store #4604",price:"$288.00",stock:4,loc:"Aisle 41 - Bay 13",dist:75,lat:38.6739,lng:-77.2528},
        {addr:"2421 Old Taylor Rd, Chesapeake VA",title:"Store #4622",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:76,lat:36.7756,lng:-76.2847},
        {addr:"12050 Jefferson Farm Pl, Waldorf MD",title:"Store #2563",price:"$288.00",stock:3,loc:"N/A",dist:80,lat:38.6211,lng:-76.9256},
        {addr:"267 Alwington Blvd, Warrenton VA",title:"Store #8552",price:"$288.00",stock:15,loc:"Aisle 43 - Bay 12",dist:80,lat:38.7322,lng:-77.7847},
        {addr:"8805 Liberia Ave, Manassas VA",title:"Store #4648",price:"$288.00",stock:3,loc:"Aisle 42 - Bay 10",dist:82,lat:38.7689,lng:-77.4733},
        {addr:"1261 N Military Hwy, Norfolk VA",title:"Store #4615",price:"$288.00",stock:3,loc:"Aisle 7 - Bay 13",dist:83,lat:36.8706,lng:-76.2094},
        {addr:"7710 Richmond Hwy, Alexandria VA",title:"Store #4638",price:"$288.00",stock:7,loc:"Aisle 8 - Bay 14",dist:83,lat:38.7483,lng:-77.0847},
        {addr:"6691 Frontier Rd, Springfield VA",title:"Store #4617",price:"$288.00",stock:3,loc:"Aisle 2 - Bay 17",dist:84,lat:38.7828,lng:-77.1878},
        {addr:"7486 Stream Walk Ln, Manassas VA",title:"Store #4607",price:"$288.00",stock:3,loc:"Aisle 6 - Bay 15",dist:85,lat:38.7867,lng:-77.5189},
        {addr:"1400 Tintern Ln, Chesapeake VA",title:"Store #4619",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:85,lat:36.6778,lng:-76.2345},
        {addr:"400 S Pickett St, Alexandria VA",title:"Store #4603",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:87,lat:38.7916,lng:-77.0769},
        {addr:"15450 John Marshall Hwy, Haymarket VA",title:"Store #4213",price:"$288.00",stock:2,loc:"Aisle 5 - Bay 12",dist:87,lat:38.7666,lng:-77.2837},
        {addr:"6555 Little River Tpke, Alexandria VA",title:"Store #4640",price:"$288.00",stock:3,loc:"Aisle 10 - Bay 14",dist:87,lat:38.8087,lng:-77.0865},
        {addr:"12275 Price Club Plaza, Fairfax VA",title:"Store #4601",price:"$288.00",stock:3,loc:"Aisle 43 - Bay 12",dist:88,lat:38.8467,lng:-77.3067},
        {addr:"6003 Oxon Hill Rd, Oxon Hill MD",title:"Store #2554",price:"$288.00",stock:1,loc:"Aisle 5 - Bay 8",dist:89,lat:38.8486,lng:-76.8887},
        {addr:"31 Windigrove Rd, Waynesboro VA",title:"Store #4654",price:"$288.00",stock:4,loc:"Aisle 43 - Bay 11",dist:89,lat:38.0722,lng:-78.8972},
        {addr:"3352 Virginia Beach Blvd, Virginia Beach VA",title:"Store #4614",price:"$288.00",stock:3,loc:"Aisle 7 - Bay 12",dist:89,lat:36.8097,lng:-76.0737},
        {addr:"3201 Blenheim Boulevard, Fairfax VA",title:"Store #4639",price:"$288.00",stock:4,loc:"Aisle 4 - Bay 11",dist:89,lat:38.8295,lng:-77.3027},
        {addr:"2020 Lynnhaven Pkwy, Virginia Beach VA",title:"Store #4626",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:90,lat:36.7431,lng:-76.0552},
        {addr:"2815 Merrilee Dr, Fairfax VA",title:"Store #4605",price:"$288.00",stock:3,loc:"Aisle 8 - Bay 4",dist:90,lat:38.8367,lng:-77.3053},
        {addr:"6210 Seven Corners Ctr, Falls Church VA",title:"Store #4608",price:"$288.00",stock:2,loc:"N/A",dist:91,lat:38.8742,lng:-77.1528},
        {addr:"157 Hillcrest Pkwy, Chesapeake VA",title:"Store #4656",price:"$288.00",stock:2,loc:"Aisle 43 - Bay 12",dist:92,lat:36.6602,lng:-76.2345},
        {addr:"25000 Riding Plaza, Chantilly VA",title:"Store #8551",price:"$288.00",stock:3,loc:"N/A",dist:94,lat:38.8963,lng:-77.4291},
        {addr:"15410 Chrysler Drive, Upper Marlboro MD",title:"Store #8550",price:"$288.00",stock:2,loc:"Aisle 45 - Bay 14",dist:94,lat:38.7947,lng:-76.9237},
        {addr:"150 Hampton Park Blvd, Capitol Heights MD",title:"Store #2555",price:"$288.00",stock:7,loc:"Aisle 5 - Bay 13",dist:96,lat:38.8976,lng:-76.9477},
        {addr:"901 Rhode Island Ave Ne, Washington DC",title:"Store #2583",price:"$288.00",stock:5,loc:"Aisle 5 - Bay 18",dist:96,lat:38.9047,lng:-77.0367},
        {addr:"2324 Elson Green Ave., Virginia Beach VA",title:"Store #4643",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:96,lat:36.8342,lng:-76.1268},
        {addr:"1651 Reston Parkway, Reston VA",title:"Store #4641",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:96,lat:38.9746,lng:-77.4087},
        {addr:"121 Burgess Rd, Harrisonburg VA",title:"Store #4645",price:"$288.00",stock:3,loc:"Aisle 38 - Bay 10",dist:98,lat:38.4083,lng:-78.9064},
        {addr:"43675 Greenway Corp Dr, Ashburn VA",title:"Store #4647",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:99,lat:39.1166,lng:-77.5387},
        {addr:"3301 E West Hwy, Hyattsville MD",title:"Store #2564",price:"$288.00",stock:2,loc:"Aisle 5 - Bay 13",dist:99,lat:38.9696,lng:-76.9377},
        {addr:"7902 Graves Mill Road, Lynchburg VA",title:"Store #4655",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:99,lat:37.3769,lng:-79.1922},
        {addr:"10301 M L King Jr. Hwy, Lanham MD",title:"Store #8548",price:"$288.00",stock:1,loc:"Aisle 5 - Bay 14",dist:101,lat:39.0287,lng:-76.9076},
        {addr:"46261 Cranston Way, Sterling VA",title:"Store #4602",price:"$27.00 (Restock)",stock:0,loc:"N/A",dist:101,lat:39.0386,lng:-77.4022}
      ];

      stores.forEach(s => {
        const isInStock = s.stock > 0;
        const icon = isInStock 
          ? "http://maps.google.com/mapfiles/ms/icons/green-dot.png" 
          : "http://maps.google.com/mapfiles/ms/icons/blue-dot.png";

        const safe = s.addr.replace(/'/g, "\\'");
        const html = `<strong>${s.title}</strong><br>${s.addr}<br>Price: ${s.price}<br>Stock: ${s.stock} <a href="#" onclick="requestDirectionsPermission('${safe}'); return false;">Get Directions</a><br>Location: ${s.loc}<br>Distance: ${s.dist} miles`;

        const marker = new google.maps.Marker({
          position: { lat: s.lat, lng: s.lng },
          map: map,
          title: s.title,
          icon: icon
        });

        const iw = new google.maps.InfoWindow({ content: html, maxWidth: 260 });

        marker.addListener("click", () => {
          iw.open(map, marker);
          document.getElementById("info-panel").innerHTML = html;
          document.getElementById("info-panel").classList.add("show");
        });
      });

      map.addListener("click", () => document.getElementById("info-panel").classList.remove("show"));
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGkKq-mR_Yb1xYsGDNJqJQaxQekWzWyOQ&callback=initMap"></script>
</body>
</html>