<!DOCTYPE html>
<html>
<head>
  <title>Ultra Pure White Semi-Gloss – Live Restock Map (Nov 29)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <style>
    body{margin:0;padding:0;font-family:Arial,sans-serif}
    #map{width:100%;height:100vh}
    h3{font-size:1.5em;padding:10px;text-align:center;margin:0;background:#1976d2;color:white}
    #location-button{
      position:absolute;top:60px;left:10px;z-index:1000;
      padding:10px;background:#fff;border:2px solid #ccc;border-radius:4px;
      cursor:pointer;font-size:1em;box-shadow:0 2px 6px rgba(0,0,0,.3)
    }
    #info-panel{
      position:absolute;top:110px;left:10px;z-index:1000;
      background:#fff;border:2px solid #ccc;border-radius:4px;
      padding:10px;max-height:220px;overflow-y:auto;display:none;width:280px;
      box-shadow:0 2px 6px rgba(0,0,0,.3);font-size:0.92em
    }
    #info-panel.show{display:block}
    a{color:#1976d2;text-decoration:none;font-weight:bold}
    a:hover{text-decoration:underline}
    .restock{color:#e67e22;font-weight:bold}
    #allow-banner{
      position:fixed;bottom:0;left:0;right:0;
      background:#fffde7;padding:12px 16px;
      border-top:2px solid #ffc107;text-align:center;
      font-size:0.95em;z-index:2000;display:none;
      box-shadow:0 -2px 8px rgba(0,0,0,.1)
    }
    #allow-banner.show{display:block}
    #allow-btn{background:#1976d2;color:#fff;padding:6px 14px;
      border:none;border-radius:4px;cursor:pointer;margin-left:8px}
    @media(max-width:768px){
      h3{font-size:1.2em}
      #info-panel{top:100px;width:92%;left:4%;font-size:0.88em}
    }
  </style>
</head>
<body>
  <h3>Ultra Pure White Semi-Gloss Enamel<br><small>Green = In Stock • Orange = Restock Imminent (≈$32) • Nov 29</small></h3>
  <button id="location-button">Center on Current Location</button>
  <div id="info-panel"></div>
  <div id="allow-banner">
    <span>This site wants to open directions in your maps app.</span>
    <button id="allow-btn">Allow</button>
  </div>
  <div id="map"></div>

  <script>
    let map, userMarker, directionsAllowed = false;

    const banner = document.getElementById('allow-banner');
    const allowBtn = document.getElementById('allow-btn');

    function requestDirectionsPermission(address) {
      if (directionsAllowed) { launchDirections(address); return; }
      banner.classList.add('show');
      allowBtn.onclick = () => {
        directionsAllowed = true;
        banner.classList.remove('show');
        launchDirections(address);
      };
    }

    function launchDirections(address) {
      const clean = address.replace(/&/g, '%26').trim();
      const enc = encodeURIComponent(clean);
      const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
      const isAndroid = /Android/.test(navigator.userAgent);

      if (isIOS) {
        window.location.href = `http://maps.apple.com/?q=${enc}`;
      } else if (isAndroid) {
        window.location.href = `geo:0,0?q=${enc}`;
      } else {
        window.open(`https://www.google.com/maps/dir/?api=1&destination=${enc}`, '_blank');
      }
    }

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 7,
        center: { lat: 37.5407, lng: -77.4360 },
        gestureHandling: 'greedy',
        mapTypeControl: false,
        streetViewControl: false
      });

      document.getElementById("location-button").addEventListener("click", () => {
        if (!navigator.geolocation) { alert("Geolocation not supported."); return; }
        navigator.geolocation.getCurrentPosition(
          pos => {
            const loc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            map.panTo(loc); map.setZoom(12);
            if (userMarker) userMarker.setPosition(loc);
            else userMarker = new google.maps.Marker({
              position: loc, map: map,
              icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
              title: "You Are Here"
            });
          },
          err => alert("Location error: " + err.message),
          { enableHighAccuracy: true, timeout: 8000 }
        );
      });

      const stores = [
        // IN STOCK (Green)
        {addr:"14025 Foulger Square, Woodbridge VA",title:"Store #4604",price:"$316.00",stock:4,dist:75,lat:38.6739,lng:-77.2528},
        {addr:"12050 Jefferson Farm Pl, Waldorf MD",title:"Store #2563",price:"$316.00",stock:4,dist:80,lat:38.6211,lng:-76.9256},
        {addr:"400 S Pickett St, Alexandria VA",title:"Store #4603",price:"$316.00",stock:4,dist:87,lat:38.7916,lng:-77.0769},
        {addr:"6210 Seven Corners Ctr, Falls Church VA",title:"Store #4608",price:"$316.00",stock:4,dist:91,lat:38.8742,lng:-77.1528},
        {addr:"25000 Riding Plaza, Chantilly VA",title:"Store #8551",price:"$316.00",stock:4,dist:94,lat:38.8963,lng:-77.4291},
        {addr:"1651 Reston Parkway, Reston VA",title:"Store #4641",price:"$316.00",stock:4,dist:96,lat:38.9746,lng:-77.4087},
        {addr:"10301 M L King Jr. Hwy, Lanham MD",title:"Store #8548",price:"$316.00",stock:4,dist:101,lat:39.0287,lng:-76.9076},

        // RESTOCK IMMINENT ≈$32 (Orange)
        {addr:"5771 Plank Road, Fredericksburg VA",title:"Store #4660",price:"$32.00",stock:0,dist:50,lat:38.2978,lng:-77.5301},
        {addr:"1261 N Military Hwy, Norfolk VA",title:"Store #4615",price:"$32.00",stock:0,dist:83,lat:36.8706,lng:-76.2094},
        {addr:"6691 Frontier Rd, Springfield VA",title:"Store #4617",price:"$32.00",stock:0,dist:84,lat:38.7828,lng:-77.1878},
        {addr:"7486 Stream Walk Ln, Manassas VA",title:"Store #4607",price:"$32.00",stock:0,dist:85,lat:38.7867,lng:-77.5189},
        {addr:"15450 John Marshall Hwy, Haymarket VA",title:"Store #4213",price:"$32.00",stock:0,dist:87,lat:38.7666,lng:-77.2837},
        {addr:"6555 Little River Tpke, Alexandria VA",title:"Store #4640",price:"$32.00",stock:0,dist:87,lat:38.8087,lng:-77.0865},
        {addr:"6003 Oxon Hill Rd, Oxon Hill MD",title:"Store #2554",price:"$32.00",stock:0,dist:89,lat:38.8486,lng:-76.8887},
        {addr:"3352 Virginia Beach Blvd, Virginia Beach VA",title:"Store #4614",price:"$32.00",stock:0,dist:89,lat:36.8097,lng:-76.0737},
        {addr:"3201 Blenheim Boulevard, Fairfax VA",title:"Store #4639",price:"$32.00",stock:0,dist:89,lat:38.8295,lng:-77.3027},
        {addr:"901 Rhode Island Ave Ne, Washington DC",title:"Store #2583",price:"$32.00",stock:0,dist:96,lat:38.9047,lng:-77.0367},
        {addr:"43675 Greenway Corp Dr, Ashburn VA",title:"Store #4647",price:"$32.00",stock:0,dist:99,lat:39.1166,lng:-77.5387},
        {addr:"46261 Cranston Way, Sterling VA",title:"Store #4602",price:"$32.00",stock:0,dist:101,lat:39.0386,lng:-77.4022}
      ];

      stores.forEach(s => {
        const isInStock = s.stock > 0;
        const icon = isInStock 
          ? "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
          : "http://maps.google.com/mapfiles/ms/icons/orange-dot.png";

        const status = isInStock ? "In Stock" : "<span class='restock'>Restock Imminent</span>";
        const safe = s.addr.replace(/'/g, "\\'");
        const html = `<strong>${s.title}</strong><br>${s.addr}<br>Price: ${s.price}<br>${status}: ${s.stock} units<br><a href="#" onclick="requestDirectionsPermission('${safe}'); return false;">Get Directions</a><br>Distance: ${s.dist} miles`;

        const marker = new google.maps.Marker({
          position: { lat: s.lat, lng: s.lng },
          map: map,
          title: s.title,
          icon: icon
        });

        const iw = new google.maps.InfoWindow({ content: html, maxWidth: 280 });

        marker.addListener("click", () => {
          iw.open(map, marker);
          document.getElementById("info-panel").innerHTML = html;
          document.getElementById("info-panel").classList.add("show");
        });
      });

      map.addListener("click", () => document.getElementById("info-panel").classList.remove("show"));
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGkKq-mR_Yb1xYsGDNJqJQaxQekWzWyOQ&callback=initMap"></script>
</body>
</html>